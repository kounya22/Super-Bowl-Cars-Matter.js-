<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Super Bowl & Cars (Matter.js)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
</head>
<body>

<canvas id="world"></canvas>

<script>
const {
    Engine, Render, Runner,
    Bodies, Body, Composite,
    Composites, Events
} = Matter;

// Áâ©ÁêÜ„Ç®„É≥„Ç∏„É≥
const engine = Engine.create();
engine.gravity.y = 1;

// ÊèèÁîª
const render = Render.create({
    canvas: document.getElementById("world"),
    engine: engine,
    options: {
        width: 5000,
        height: 3000,
        wireframes: false,
        background: "#027"
    }
});
Render.run(render);
Runner.run(Runner.create(), engine);

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// üß± „Çπ„ÉÜ„Éº„Ç∏ÔºàÁ´Ø„Å´Â£Å„ÇíËøΩÂä†Ôºâ
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const ground = Bodies.rectangle(450, 3010, 1500000, 100, {
    isStatic: true,
    render: { fillStyle: "#444" }
});

const ground2 = Bodies.rectangle(450, 100, 1500000, 50, {
    isStatic: true,
    render: { fillStyle: "#444" }
});

// Â∑¶Â£Å„ÉªÂè≥Â£ÅÔºà„Å®„Å¶„ÇÇÈ´ò„Åè„Åó„Å¶ËêΩ„Å°„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
const leftWall = Bodies.rectangle(-10, 2000, 70, 5500000, {
    isStatic: true,
    render: { fillStyle: "#666" }
});

const rightWall = Bodies.rectangle(5010, 2000, 50, 5500000, {
    isStatic: true,
    render: { fillStyle: "#666" }
});

Composite.add(engine.world, [ground, leftWall, rightWall]);

const spinner = Bodies.rectangle(6000, 450, 200, 200, {
    isStatic: true,
    render: { fillStyle: "#00ccff" }
});
Composite.add(engine.world, spinner);

// Âõû„ÅóÁ∂ö„Åë„Çã
Events.on(engine, "beforeUpdate", () => {
    Body.rotate(spinner, -0.1); // 0.05„É©„Ç∏„Ç¢„É≥„Åö„Å§ÂõûËª¢
});

const slope = Bodies.rectangle(1000, 2500, 300, 20, {
    isStatic: false,
    angle: Math.PI * -0.20, // -0.20 „É©„Ç∏„Ç¢„É≥ÔºàÂ∞ë„ÅóÂè≥‰∏ä„Åå„ÇäÔºâ
    render: { fillStyle: "#666" }
});

function spawnRocks(amount) {
    for (let i = 0; i < amount; i++) {
        const x = 300 + Math.random() * 6000;  // Â∫É„ÅÑÁØÑÂõ≤„Å´Êï£„Çâ„Å∞„Åõ„Çã
        const y = 200 + Math.random() * 100;   // Èáç„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´„É©„É≥„ÉÄ„É†

        const r = 30 + Math.random() * 10;     // Â§ß„Åç„Åï„ÇÇ„É©„É≥„ÉÄ„É†

        const rock = Bodies.circle(x, y, r, {
            density: 0.001,
            friction: 0.8,
            restitution: 2, // Ë∑≥„Å≠„Åô„Åé!!
            render: {
                fillStyle: "#22"
            }
        });

        Composite.add(engine.world, rock);
    }
}

// „Çπ„Éº„Éë„Éº„Éú„Éº„É´„Çí150ÂÄãÁîüÊàê
spawnRocks(150);

function spawncircle(amount) {
    for (let i = 0; i < amount; i++) {
        const x = 300 + Math.random() * 6000;  // Â∫É„ÅÑÁØÑÂõ≤„Å´Êï£„Çâ„Å∞„Åõ„Çã
        const y = 200 + Math.random() * 100;   // Èáç„Å™„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´„É©„É≥„ÉÄ„É†

        const r = 30 + Math.random() * 10;     // Â§ß„Åç„Åï„ÇÇ„É©„É≥„ÉÄ„É†

        const rock = Bodies.circle(x, y, r, {
            density: 0.001,
            friction: 0.8,
            restitution: 2, // Ë∑≥„Å≠„Åô„Åé!!!
            render: {
                fillStyle: "#22"
            }
        });

        Composite.add(engine.world, rock);
    }
}

// „Çπ„Éº„Éë„Éº„Éú„Éº„É´„Çí150ÂÄãÁîüÊàê
spawncircle(150);
//‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// üöó „Çπ„Éù„Éº„ÉÑ„Ç´„ÉºÊú¨‰Ωì
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// Ëªä‰ΩìÔºà‰Ωé„Åè„Å¶Èï∑„ÅÑ„Çπ„Éù„Éº„ÉÑ„Ç´„Éº„Å£„ÅΩ„ÅÑÂΩ¢Ôºâ
const carBody = Bodies.rectangle(200, 500, 140, 30, {
    render: {
        fillStyle: "#ff3333",  // Ëµ§„ÅÑ„Çπ„Éù„Éº„ÉÑ„Ç´„Éº
        strokeStyle: "#aa0000",
        lineWidth: 3
    }
});

// „Ç¨„É©„Çπ
const glass = Bodies.rectangle(200, 485, 60, 15, {
    render: {
        fillStyle: "#77ccff",
        strokeStyle: "#005577",
        lineWidth: 2
    }
});

// „Çø„Ç§„É§ÔºàÂâçÂæåÔºâ
const wheelA = Bodies.circle(160, 520, 20, {
    render: { fillStyle: "black" }
});

const wheelB = Bodies.circle(240, 520, 20, {
    render: { fillStyle: "black" }
});

// Ëªä„Çí‰∏Ä„Å§„ÅÆ Composite „Å´„Åæ„Å®„ÇÅ„Çã
const car = Composite.create();
Composite.add(car, [carBody, glass, wheelA, wheelB]);

// Ëªä‰Ωì„Å®„Ç¨„É©„Çπ„ÇíÂõ∫ÂÆöÔºà„Åè„Å£„Å§„Åë„ÇãÔºâ
const c1 = Matter.Constraint.create({
    bodyA: carBody,
    bodyB: glass,
    stiffness: 1,
    render: { visible: false }
});
Composite.add(car, c1);

// „Çø„Ç§„É§„Çí„Åè„Å£„Å§„Åë„ÇãÔºà„Çµ„Çπ„Éö„É≥„Ç∑„Éß„É≥Ôºâ
Composite.add(car, Matter.Constraint.create({
    bodyA: carBody,
    bodyB: wheelA,
    pointA: { x: -50, y: 15 },
    stiffness: 0.3,
    render: { visible: false }
}));

Composite.add(car, Matter.Constraint.create({
    bodyA: carBody,
    bodyB: wheelB,
    pointA: { x: 50, y: 15 },
    stiffness: 0.3,
    render: { visible: false }
}));

Composite.add(engine.world, car);

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// üöóüöó NPCËªäÔºàËá™ÂãïÈÅãËª¢ËªäÔºâ„ÇíËøΩÂä†„Åô„ÇãÂ†¥ÊâÄ
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// NPCËªä„Çí‰Ωú„ÇãÈñ¢Êï∞
function createNpcCar(x, y) {
    const body = Bodies.rectangle(x, y, 120, 40, {
        render: { fillStyle: "#ffaa00" },
        frictionAir: 0.02
    });

    const wheelA = Bodies.circle(x - 40, y + 20, 20, { render: { fillStyle: "#333" } });
    const wheelB = Bodies.circle(x + 40, y + 20, 20, { render: { fillStyle: "#333" } });

    const axelA = Matter.Constraint.create({
        bodyA: body,
        bodyB: wheelA,
        pointA: { x: -40, y: 20 },
        stiffness: 0.6
    });
    const axelB = Matter.Constraint.create({
        bodyA: body,
        bodyB: wheelB,
        pointA: { x: 40, y: 20 },
        stiffness: 0.6
    });

    Composite.add(engine.world, [body, wheelA, wheelB, axelA, axelB]);

    return { body, wheelA, wheelB };
}

// NPC„ÅÆAIÔºà„É©„É≥„ÉÄ„É†Ë°åÂãïÔºâ
function npcBrain(npc) {
    setInterval(() => {
        const force = {
            x: (Math.random() - 0.5) * 100,
            y: 0
        };
        Body.applyForce(npc.body, npc.body.position, force);

        // Â∞ë„ÅóÂõûËª¢„Åï„Åõ„Å¶‰∏çÂÆâÂÆö„Å´
        Body.setAngularVelocity(npc.body, (Math.random() - 0.5) * 0.01);

    }, 300);
}

// NPC„Çí1Âè∞Âá∫„Åô
const npc1 = createNpcCar(800, 500);
npcBrain(npc1);

const npc2 = createNpcCar(800, 50);
npcBrain(npc2);

const npc3 = createNpcCar(800, 50);
npcBrain(npc3);

const npc4 = createNpcCar(800, 50);
npcBrain(npc4);

const npc5 = createNpcCar(800, 500);
npcBrain(npc1);

const npc6 = createNpcCar(800, 50);
npcBrain(npc2);

const npc7 = createNpcCar(800, 50);
npcBrain(npc3);

const npc8 = createNpcCar(800, 50);
npcBrain(npc4);
// ÂøÖË¶Å„Å™„ÇâË§áÊï∞ËøΩÂä†
// const npc2 = createNpcCar(1500, 500);
// npcBrain(npc2);
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// üéÆ Êìç‰ΩúÔºà‚Üê ‚Üí „ÅßÂä†ÈÄüÔºâ
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let force = 0;

document.addEventListener("keydown", e => {
    if (e.key === "ArrowRight") force = 0.01;
    if (e.key === "ArrowLeft")  force = -0.01;
    if (e.key === "d") force = 0.05;
    if (e.key === "a") force = -0.05;

    // „Çπ„Éö„Éº„Çπ„Åß„Ç∏„É£„É≥„ÉóÔºàÂº∑„ÇÅÔºâ
    if (e.key === " ") {
        Body.applyForce(carBody, carBody.position, { x: 0, y: -0.2 });
    }
        if (e.key === "ArrowDown") {
        Body.applyForce(carBody, carBody.position, { x: 0, y: 0.3 });
    }
    // R„Ç≠„Éº„ÅßËªä„ÇíÂàùÊúü‰ΩçÁΩÆ„Å´„É™„Çª„ÉÉ„Éà
if (e.key === "r" || e.key === "R") {
    // ‰ΩçÁΩÆ„Çí„É™„Çª„ÉÉ„Éà
    Body.setPosition(carBody, { x: 200, y: 500 });
    Body.setPosition(glass,   { x: 200, y: 485 });
    Body.setPosition(wheelA,  { x: 160, y: 520 });
    Body.setPosition(wheelB,  { x: 240, y: 520 });

    // ËßíÂ∫¶„Çí„É™„Çª„ÉÉ„Éà
    Body.setAngle(carBody, 0);
    Body.setAngle(glass, 0);
    Body.setAngle(wheelA, 0);
    Body.setAngle(wheelB, 0);

    // ÈÄüÂ∫¶„ÇÇ0„Å´„Åó„Å™„ÅÑ„Å®„Å∂„Å£È£õ„Çì„Åß„ÅÑ„Åè
    Body.setVelocity(carBody, { x: 0, y: 0 });
    Body.setVelocity(glass,   { x: 0, y: 0 });
    Body.setVelocity(wheelA,  { x: 0, y: 0 });
    Body.setVelocity(wheelB,  { x: 0, y: 0 });

    // ÂõûËª¢ÈÄüÂ∫¶„ÇÇ„É™„Çª„ÉÉ„Éà
    Body.setAngularVelocity(carBody, 0);
    Body.setAngularVelocity(glass, 0);
    Body.setAngularVelocity(wheelA, 0);
    Body.setAngularVelocity(wheelB, 0);
}

});

document.addEventListener("keyup", e => {
    if (e.key === "ArrowRight" || e.key === "ArrowLeft") force = 0;
});

// ÊØé„Éï„É¨„Éº„É†„ÅÆÊõ¥Êñ∞Ôºà„Çø„Ç§„É§„Å´Âäõ„ÇíÂä†„Åà„ÇãÔºâ
Events.on(engine, "beforeUpdate", () => {
    Body.applyForce(wheelA, wheelA.position, { x: force, y: 0 });
    Body.applyForce(wheelB, wheelB.position, { x: force, y: 0 });
});

</script>
</body>
</html>
